<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Send Money</title>

    <!-- Redirect if not logged in -->
    <script>
        if (localStorage.getItem("isLoggedIn") !== "true") {
            window.location.href = "login.html";
        }
    </script>

    <link rel="stylesheet" href="plugins/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="plugins/themefisher-font.v-2/style.css">
    <link rel="stylesheet" href="css/style.css">

    <style>
        body {
            background: #f4f7fb;
        }
        .send-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 25px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .page-header {
            background: #002366;
            color: white;
            padding: 20px;
        }
        .btn-primary {
            background: #002366 !important;
            border: none;
        }
    </style>
</head>

<body id="body">

<!-- PAGE TOP BAR (same style as home.html) -->
<section class="page-header mb-4">
    <div class="container d-flex align-items-center justify-content-between">
        <h4 class="m-0">Send Money</h4>
        <button onclick="history.back()" class="btn btn-light btn-sm">Back</button>
    </div>
</section>

<div class="container">
    <div class="send-container">

        <h5 class="mb-3">Transfer Details</h5>

        <div class="form-group">
            <label>Receiver Email</label>
            <input id="email" type="email" class="form-control" placeholder="example@gmail.com">
        </div>

        <div class="form-group mt-3">
            <label>Amount (â‚¬)</label>
            <input id="amount" type="number" class="form-control" placeholder="0.00">
        </div>

        <div class="form-group mt-3">
            <label>Description (optional)</label>
            <input id="description" type="text" class="form-control" placeholder="eg. Gift, Payment">
        </div>

        <br>

        <button id="sendBtn" class="btn btn-primary btn-block py-2">
            SEND MONEY
        </button>

        <div id="loading" style="display:none;" class="mt-3 text-center">
            <div class="spinner-border text-primary"></div>
        </div>

    </div>
</div>



<script src="plugins/jquery/dist/jquery.min.js"></script>
<script src="plugins/bootstrap/dist/js/bootstrap.min.js"></script>

<script>
const API_BASE = "https://candlelightservices.candlelightspecialneeds.org/nibble_filmbase_api/koinsave_api";

document.getElementById("sendBtn").addEventListener("click", sendMoney);

async function sendMoney() {
    const email = document.getElementById("email").value.trim();
    const amount = document.getElementById("amount").value.trim();
    const desc = document.getElementById("description").value.trim();

    const senderId = localStorage.getItem("userId");

    if (!senderId) {
        alert("User not logged in");
        return;
    }
    if (email === "" || amount === "") {
        alert("Email and amount are required");
        return;
    }

    document.getElementById("sendBtn").disabled = true;
    document.getElementById("loading").style.display = "block";

    try {
        const res = await fetch(`${API_BASE}/send_money.php`, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                sender_id: senderId,
                receiver_email: email,
                amount: amount,
                description: desc
            })
        });

        const data = await res.json();

        document.getElementById("loading").style.display = "none";
        document.getElementById("sendBtn").disabled = false;

        if (data.status === "success") {
            alert("Transfer Successful!");
            window.location.href = "home.html";
        } else {
            alert(data.message);
        }

    } catch (err) {
        document.getElementById("loading").style.display = "none";
        document.getElementById("sendBtn").disabled = false;
        alert("Error: " + err);
    }
}
</script>

</body>
</html>